---
title: vue源码学习
tags: vue js
categories: 编程
date: 2018-04-24 11:26:18
---


## 简单的数据劫持
```javascript
// 数据劫持就是所有对象全部通过 definProperty 定义，利用 get, set 函数

  function MyVue(options = {}) {
    this.$options = options;
    var data = this.$data = this.$options.data;

    observe(data);

    for (let key in data) {
      // this 代理 this.data
      Object.defineProperty(this, key ,{
        enumerable: true,
        set(newVal){
          this.$data[key] = newVal;
        },
        get(){
          return this.$data[key];
        }
      });
    }
  }


  function Observe(data) {
    for (let key in data) {
      let val = data[key];
      observe(val);
      Object.defineProperty(data, key, {
        enumerable: true,
        get(){
          return val;
        },
        set(newVal){
          if (newVal === val) {
            return;
          }

          val = newVal;

          // 如果 newVal 是对象类型，需要对对象下的所有子字段进行劫持
          observe(newVal);
        }
      })
    }
  }

  // 观察对象，给对象增加Object.defineProperty
  function observe(data) {
    if (typeof data != 'object') return;
    
    return new Observe(data);
  }
```
