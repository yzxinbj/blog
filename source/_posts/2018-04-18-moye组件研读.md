---
title: moye组件研读
date: 2018-04-18 15:39:33
tags:
categories:
---
### 方法静态化？
```javascript
/**
 * 方法静态化
 *
 * 反绑定、延迟绑定
 *
 * @inner
 * @param {Function} method 待静态化的方法
 * @return {Function} 静态化包装后方法
 */
 function generic(method) {
        return function () {
            return Function.call.apply(method, arguments);
        };
    }

var exports = {

    /**
     * 数组切片方法
     *
     * @method module:lib.slice
     *
     * @param {Array} array 输入数组或类数组
     * @param {number} startIndex 切片的开始索引
     * @param {number} endIndex 切片的结束索引
     *
     * @return {Array} 新的数组
     */
    slice: generic(Array.prototype.slice),
}

// slice 相当于
var slice = function(){
   return Function.call.apply(Array.prototype.slice, arguments);
}
/***************************/
function fn(fn) {
  var args = slice(arguments, 1);
}
// 相当于
function fn(fn){
  var args = Function.call.apply(Array.prototype.slice, arguments);
  // 上面相当于
  var args = Array.prototype.slice.apply(arguments);
}
```

- 结论
Function()? 相当于一个匿名执行函数，通过 call 或 apply 来 改变它的 this。
而 Function.call.apply是:
* call的 this是 Function，是它的调用者，是要执行的函数，这个 this 必然是函数类型，
* call 的第一个参数才是 Function 的 this, call的 this 和 Function 的 this 要区分清楚
* 继call后调用aplly是改变了 call 的 this，即改变了 call 的调用者，改变了要被执行的函数，所以 apply 第一个参数要传函数类型，否则会报错


扩展
```javascript
function noop(){}
var Call = noop.call.bind(noop.apply);
// 相当于
var Call = noop.apply.call;
// 即调用时拉平
Call(function(){}/*要执行的函数*/, window/*要执行函数内的this指向*/,[]/*给要执行函数传的参数*/)

// 所以
var Call = noop.call.apply;
Call(function(){}/*要执行的函数*/, [window/*要执行函数内的this指向*/, .../*给要执行函数传的参数*/]);
```


### 柯里化
```javascript
/**
 * 为函数提前绑定参数（柯里化）
 *
 * @see http://en.wikipedia.org/wiki/Currying
 * @method module:lib.curry
 * @param  {Function} fn   要绑定的函数
 * @param  {*}        args 函数执行时附加到执行时函数前面的参数
 * @return {Function}      封装后的函数
 */
function curry(fn) {

    var args = slice(arguments, 1); // 获取提前要绑定的参数

    return function () {

        // 提前绑定的，和curry 柯理化之后的入参合并
        // 此处的 arguments 和 上面的 arguments 不同，要分清楚
        return fn.apply(this, args.concat(slice(arguments)));
    };

}
```