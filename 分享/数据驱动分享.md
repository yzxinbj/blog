title: 关于数据驱动
speaker: Dane
transition: zoomin

[slide]
##  主题：什么是数据驱动？


[slide]
### 数据驱动是我们要实现下面这些数字：
- 是我们今年GMV要`4000000000`
- 冲击`10000000000` 市值公司
- 大家都得撸起袖子加油干！！

![](/11.jpg)


[slide]
## 提纲
- 介绍浏览器是如何渲染一个页面的
- 介绍云鸟目前前端开发现状，以及数据驱动和事件驱动的区别和优缺点
- 对比 vue 和 其他框架有哪些优势，我们为什么选择vue（看时间简单说一下）


[slide]
## PART 1 浏览器模型  
- 主控进程：负责主控，协调
- 第三方插件进程：每种类型插件一个进程
- GPU 进程：负责3D绘制
- 浏览器渲染进程(主要介绍)


[slide]
## 浏览器内核
- 默认每个Tab页面一个进程，互不影响，控制页面渲染，脚本执行，事件处理等
- 这个进程是多线程的：   
![](/11.png)


[slide]
## 那么当我们输入一个网址拿到了数据后浏览器是如何处理怎么把它呈现出来的？  
![](/12.png)


[slide]
先看一个图  
![](/18.png)

[slide]
我们逐步解释一下这个图
```html
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="style.css" rel="stylesheet">
    <title>Critical Path</title>
  </head>
  <body>
    <p>Hello <span>web performance</span> students!</p>
    <div><img src="awesome-photo.jpg"></div>
  </body>
</html>
```
![](/14.png)


[slide]
css规则树的解析和 dom树的解析是一致的，只不过最后是转换为 cssom
```
body { font-size: 16px }
p { font-weight: bold }
span { color: red }
p span { display: none }
img { float: right }

```
![](/15.png)

[slide]
当 cssom 树 和 dom 树都解析好了，就开始构建渲染树了
![](/16.png)

[slide]
最后一步--渲染
![](/17.png)

[slide]
简单的讲：  
`浏览器拿到数据` --各种解析--> `dom tree + cssom tree =  render tree` --渲染--> `网页`   
 开发人员可以通过浏览器暴露的接口来修改 `dom`，`cssom` 来改变视图

[slide]
## PART 2 工作现状&事件驱动和数据驱动区别   

- 知道了浏览器是如何工作的，接下来就介绍下工作中是如何实践的  
- 以及我们使用的事件驱动和数据驱动

[slide]
## 事件驱动
```javascript
var filterList = util.getFormData($(nodes.searchBox), true);
// 获取输入联想的id值
if ($(nodes.wareHouse).val() && $(nodes.wareHouse).attr('suggestvalue')) {
    filterList.warehouse_id = $(nodes.wareHouse).attr('suggestvalue');
}
if ($(nodes.driverName).val() && $(nodes.driverName).attr('suggestvalue')) {
    filterList.driver_id = $(nodes.driverName).attr('suggestvalue');
}
if ($(nodes.customerName).val() && $(nodes.customerName).attr('suggestvalue')) {
    filterList.customer_id = $(nodes.customerName).attr('suggestvalue');
}
```

[slide]
```javascript
 util.ajax({
    url: '/api/v1/task/get_list',
    loading: true,
    node: $('#contentTable'),
    data: savedParam,
    success: function (result) {
        var info = result.info;
        if (!info.list) {
            info.list = [];
        }
        if (!info.fcc) {
            info.fcc = '';
        }
        // 显隐分页行控制
        if (info.list.length === 0) {
            $(nodes.bottomLine).addClass('hidden');
        } else {
            // 设置分页和数据总量
            $(nodes.total).html(info.pagination.total);
            pager.setTotal(info.pagination.total_page);
            if (savedParam.page) {
                pager.setPage(savedParam.page - 1);
            } else {
                pager.setPage(0);
            }
            $(nodes.bottomLine).removeClass('hidden');
        }
        // 渲染数据
        var html = bt('t:table', info || {});
        $(nodes.tableBox).html(html);
    }
});
```

[slide]
![](/5.png)


[slide]
## 数据驱动
```javascript
this.dialogVisible = false;
```

```javascript
this.$http.get('/api/customer/task/list', {
  params: searchParams
}).then((data) => {
  let info = data.info;
  this.list = info.list || [];
  this.count = info.count;
  this.totalpage = info.totalpage;
});
```

```xml
<span class="edit" @click="bidDriver(scope.row.driver_id , scope.row.id)">确定</span>
```

[slide]
## 如果感觉不出来有什么区别？
## 我再举一个例子

[slide]
## 在 W 端 使用一个车型弹框组件是怎样的？
![](/1.png)
[slide]
![](/2.png)
[slide]
![](/3.png)


[slide]
## 在鸟创盟是怎样的
![](/car_type_jm.png)


[slide]
## 区别
||事件驱动|数据驱动|
|:----|----|-----|
| 开发上  | 通过特定的选择器查找到需要操作的节点 -> 给节点添加相应的事件监听| 读取模板，同时获得数据，并建立 VM(view-model) 的抽象层 -> 在页面进行填充 |
| 响应用户操作上  | 用户执行某事件（点击，输入，后退等等） -> 调用 JavaScript 来修改节点  |用户执行某个操作 -> 反馈到 VM 处理（可以导致 Model 变动） -> VM 层改变，通过绑定关系直接更新页面对应位置的数据 |

[slide]
## 数据驱动的优点
- 对于简单的页面并没多少差异但对于复杂的页面，数据驱动更改了事件驱动通过操作节点的方式频繁更改视图，实现了 `V` 和 `M` 的双向绑定  
- vue 是一个 MVVM 框架，这让我们的关注点从如何操作DOM变成了如何更新JavaScript对象的状态，操作JavaScript对象比DOM简单多了！  
![](/6.png)

[slide]
## 解释下 VM
VM就是 viewmodel，viewmodel是 mvvm 设计模式中的一层
- `MVVM`  
MVVM最早由微软提出来，它借鉴了桌面应用程序的MVC思想，在前端页面中，
把Model用纯JavaScript对象表示，View负责显示，两者做到了最大限度的分离。
把Model和View关联起来的就是ViewModel。ViewModel负责把Model的数据同步到
View显示出来，还负责把View的修改同步回Model。


[slide]
## 为什么赋值语句会影响视图变化？
## Vue是怎么做的？

[slide]
## 数据劫持
![](/9.png)

[一个简单的数据劫持](https://yzxinbj.github.io/blog/2018/04/24/vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/)

[slide]
> 简单讲就是 Vue 通过 遍历 Data 调用 Object.defineProperty 为每个 data 添加存取器，
在数据变更的时候，会通过 getter/setter，用户看不到，但在内部它们让 Vue 追踪依赖，
在属性被访问和修改时 Notify 通知变化，通知到 Watcher 后再调用 `render` `Function`，
render 内部还会有 diff 对比 ，同步Data 等等，最后更新视图


[slide]
## 关于 Object.defineProperty
[MDN-Object.defineProperty](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)

[点下试试](https://yzxinbj.github.io/blog/2017/10/31/%E5%85%B3%E4%BA%8E-configurable/)


[slide]
## PART 3
从以下方面对比 Angular，React，Ember，且对于云鸟而言更关注的是什么  
- 上手难度
- 生态
- 性能


[slide]
# 谢谢！

